<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第2章 字符串和正则表达式 | Huangshunq</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.61085d8a.css" as="style"><link rel="preload" href="/assets/js/app.73a72f5f.js" as="script"><link rel="preload" href="/assets/js/7.3a68b4cb.js" as="script"><link rel="prefetch" href="/assets/js/10.b3f84bea.js"><link rel="prefetch" href="/assets/js/2.641e37de.js"><link rel="prefetch" href="/assets/js/3.e671b636.js"><link rel="prefetch" href="/assets/js/4.346c72c5.js"><link rel="prefetch" href="/assets/js/5.55c5d5c5.js"><link rel="prefetch" href="/assets/js/6.b5cdcf90.js"><link rel="prefetch" href="/assets/js/8.5d382610.js"><link rel="prefetch" href="/assets/js/9.465ab1c2.js"><link rel="prefetch" href="/assets/js/11.f3da93cc.js"><link rel="prefetch" href="/assets/js/12.6e04c87e.js"><link rel="prefetch" href="/assets/js/13.c0f5d400.js"><link rel="prefetch" href="/assets/js/14.581253b5.js"><link rel="prefetch" href="/assets/js/15.829c5578.js"><link rel="prefetch" href="/assets/js/16.57a9ab57.js"><link rel="prefetch" href="/assets/js/17.6a43ebee.js"><link rel="prefetch" href="/assets/js/18.76324f2b.js"><link rel="prefetch" href="/assets/js/19.5d3ea9e9.js"><link rel="prefetch" href="/assets/js/20.45560d07.js"><link rel="prefetch" href="/assets/js/21.3490a2ad.js"><link rel="prefetch" href="/assets/js/22.a02be50f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.61085d8a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Huangshunq</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">档案</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ES6/01-块级作用域绑定.html" class="nav-link">《深入理解ES6》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ES6/02-字符串和正则表达式.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/Huangshunq/Huangshunq.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">档案</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ES6/01-块级作用域绑定.html" class="nav-link">《深入理解ES6》</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ES6/02-字符串和正则表达式.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/Huangshunq/Huangshunq.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/ES6/01-块级作用域绑定.html" class="sidebar-link">第1章 块级作用域绑定</a></li><li><a href="/ES6/02-字符串和正则表达式.html" class="active sidebar-link">第2章 字符串和正则表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#关于unicode的字符编码基本概念" class="sidebar-link">关于Unicode的字符编码基本概念</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#更好的unicode支持" class="sidebar-link">更好的Unicode支持</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#子串识别" class="sidebar-link">子串识别</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#repeat" class="sidebar-link">repeat()</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#正则表达式y修饰符" class="sidebar-link">正则表达式y修饰符</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#复制正则表达式" class="sidebar-link">复制正则表达式</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#flags属性" class="sidebar-link">flags属性</a></li><li class="sidebar-sub-header"><a href="/ES6/02-字符串和正则表达式.html#模板字面量" class="sidebar-link">模板字面量</a></li></ul></li><li><a href="/ES6/03-函数.html" class="sidebar-link">第3章 函数</a></li><li><a href="/ES6/04-拓展对象的功能性.html" class="sidebar-link">第4章 拓展对象的功能性</a></li><li><a href="/ES6/05-解构：使数据访问更便捷.html" class="sidebar-link">第5章 解构：使数据访问更便捷</a></li><li><a href="/ES6/06-Symbol和Symbol属性.html" class="sidebar-link">第6章 Symbol和Symbol属性</a></li><li><a href="/ES6/07-Set集合与Map集合.html" class="sidebar-link">第7章 Set集合与Map集合</a></li><li><a href="/ES6/08-Iterator和Generator.html" class="sidebar-link">第8章 Iterator和Generator</a></li><li><a href="/ES6/09-类.html" class="sidebar-link">第9章 类</a></li><li><a href="/ES6/10-改进数组的功能.html" class="sidebar-link">第10章 改进数组的功能</a></li><li><a href="/ES6/11-Promise与异步编程.html" class="sidebar-link">第11章 Promise与异步编程</a></li><li><a href="/ES6/12-代理（Proxy）和反射（Reflection）API.html" class="sidebar-link">第12章 代理（Proxy）和反射（Reflection）API</a></li><li><a href="/ES6/13-用模块封装代码.html" class="sidebar-link">第13章 用模块封装代码</a></li><li><a href="/ES6/附录A.html" class="sidebar-link">附录 A 较小变动</a></li><li><a href="/ES6/附录B-ES2016.html" class="sidebar-link">附录 B ES2016（ES7）</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="第2章-字符串和正则表达式"><a href="#第2章-字符串和正则表达式" aria-hidden="true" class="header-anchor">#</a> 第2章 字符串和正则表达式</h1> <h2 id="关于unicode的字符编码基本概念"><a href="#关于unicode的字符编码基本概念" aria-hidden="true" class="header-anchor">#</a> 关于Unicode的字符编码基本概念</h2> <blockquote><p><strong>码位</strong>（code point），又叫代码点，指Unicode中为每个相应的字符分配的唯一编号（标识符），一个字符只会对应一个码位。</p> <p>将每个字符用其对应的码位表示，并将该码位存储在计算机上的过程，叫做 <strong>字符编码</strong>（或简称编码，character encode）。</p> <p><strong>编码单元</strong>（code unit）或叫代码单元，则是针对编码方式而言，它指进行编码的过程中对一个字符进行编码以后，对应的码位所要占用的最小存储单位，可能是一个字节，也可能是多个字节。编码/解码算法是以编码单元为最小单元来操作的。</p></blockquote> <h2 id="更好的unicode支持"><a href="#更好的unicode支持" aria-hidden="true" class="header-anchor">#</a> 更好的Unicode支持</h2> <p>在UTF-16中，前2^16^个码位均以16位的编码单元表示，这个范围被称作 <strong>基本多文种平面</strong> （BMP，Basic Multilingual Plane）。超出这个范围的码位则要归属于某个辅助平面（supplementary plane），其中的码位仅用16位就无法表示了。为此，UTF-16引入了代理对（surrogate pair），其规定用两个16位编码单元表示一个码位。此时，字符串中的字符有两种，一种是由一个编码单元16位表示的BMP字符，另一种是由两个编码单元32位表示的 <strong>辅助平面字符</strong> 。</p> <p>在ES5中，JavaScript字符串一直基于16位字符编码（UTF-16）进行构建，所有字符串的操作都基于16位编码单元。如果采用这种方式处理包含代理对的UTF-16编码字符，可能得到错误的结果。</p> <h3 id="codepointat"><a href="#codepointat" aria-hidden="true" class="header-anchor">#</a> <code>codePointAt()</code></h3> <p>ES6增加了完全支持UTF-16的<code>codePointAt()</code>方法，这个方法接受编码单元的位置而非字符位置作为参数，返回与字符串中给定位置对应的码位，即一个整数值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">&quot;𠮷a&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// ES5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//55362</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//57271</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//97</span>

<span class="token comment">// ES6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//134071</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//57271</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//97</span>
</code></pre></div><p>对于BMP字符集中的字符，<code>codePointAt()</code>方法返回值与<code>charCodeAt()</code>方法相同。而对于非BMP字符集来说，比如text的第一个字符，<code>charCodeAt()</code>返回位置0处的第一个编码单元，而<code>codePointAt()</code>则返回完整的码位。其它的位置，二者返回值相同。</p> <h3 id="string-fromcodepoint"><a href="#string-fromcodepoint" aria-hidden="true" class="header-anchor">#</a> <code>String.fromCodePoint()</code></h3> <p>ECMAScript通常会面向同一个操作提供正反两种方法。相对于<code>codePointAt()</code>，有<code>String.fromCodePoint()</code>方法根据指定的码位生成返回一个字符。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">134071</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;𠮷&quot;</span>
</code></pre></div><p>这相当于<code>String.fromCharCode()</code>（不适用于非BMP码位）的拓展方法。</p> <h3 id="normalize"><a href="#normalize" aria-hidden="true" class="header-anchor">#</a> <code>normalize()</code></h3> <blockquote><p>如果不需要开发多语种的应用，基本不用此方法。如果需要，在排序和比较操作前，将被操作字符串按照统一标准进行标准化，即<code>normalize()</code>。</p></blockquote> <p>在Unicode中，有可能使一个字符有多种字符编码方式，各种方式生成的码位是不同的，但是所表达的字符（包括语义、视觉上）是一样的。</p> <p>比如，许多欧洲语言有语调符号和重音符号。为了表示它们，Unicode 提供了两种方法。一种是直接提供带重音符号的字符，比如Ǒ（\u01D1）。另一种是提供合成符号（combining character），即原字符与重音符号的合成，两个字符合成一个字符，比如O（\u004F）和ˇ（\u030C）合成Ǒ（\u004F\u030C）。</p> <p>ES6 提供字符串实例的<code>normalize()</code>方法，用来将字符的不同表示方法统一为同样的形式，这称为 Unicode 正规化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\u01D1'</span><span class="token operator">===</span><span class="token string">'\u004F\u030C'</span> <span class="token comment">//false</span>

<span class="token string">'\u01D1'</span><span class="token punctuation">.</span>length <span class="token comment">// 1</span>
<span class="token string">'\u004F\u030C'</span><span class="token punctuation">.</span>length <span class="token comment">// 2</span>

<span class="token string">'\u01D1'</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'\u004F\u030C'</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// true</span>
</code></pre></div><p><code>normalize</code>方法可以接受一个参数来指定normalize的方式，参数的四个可选值如下。</p> <ul><li><code>NFC</code>，默认参数，表示“标准等价合成”（Normalization Form Canonical Composition），返回多个简单字符的合成字符。所谓“标准等价”指的是视觉和语义上的等价。</li> <li><code>NFD</code>，表示“标准等价分解”（Normalization Form Canonical Decomposition），即在标准等价的前提下，返回合成字符分解的多个简单字符。</li> <li><code>NFKC</code>，表示“兼容等价合成”（Normalization Form Compatibility Composition），返回合成字符。所谓“兼容等价”指的是语义上存在等价，但视觉上不等价，比如“囍”和“喜喜”。（这只是用来举例，normalize方法不能识别中文。）</li> <li><code>NFKD</code>，表示“兼容等价分解”（Normalization Form Compatibility Decomposition），即在兼容等价的前提下，返回合成字符分解的多个简单字符。</li></ul> <h3 id="正则表达式u修饰符"><a href="#正则表达式u修饰符" aria-hidden="true" class="header-anchor">#</a> 正则表达式u修饰符</h3> <p>正则表达式默认将字符串中每个字符按照16位编码单元处理。而ECMAScript 6 给正则表达式定义了一个支持Unicode的u修饰符。当一个正则表达式添加了u修饰符时，它就从编码单元操作模式切换为字符模式（正确处理非BMP字符）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'𠮷'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex">/^.$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token regex">/^.$/u</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>
</code></pre></div><p>可以通过以下方式检测当前引擎是否支持u修饰符：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hasRegExpU</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="子串识别"><a href="#子串识别" aria-hidden="true" class="header-anchor">#</a> 子串识别</h2> <p>在一段字符串中检测另一段子字符串，ES6提供了新方法：</p> <ul><li><code>includes()</code>方法：如果在字符串中检测到指定文本则返回<code>true</code>，否则返回<code>false</code>。</li> <li><code>startsWith()</code>方法：如果在字符串起始部分检测到指定文本则返回<code>true</code>，否则返回<code>false</code>。</li> <li><code>endsWith()</code>方法：如果在字符串结束部分检测到指定文本则返回<code>true</code>，否则返回<code>false</code>。</li></ul> <p>以上方法都接受两个参数：第一个指定要搜索的文本；第二个参数可选，指定一个开始搜索的位置的索引值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true. 从索引的第四位开始搜索，即从第一个o开始向后搜索。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true. 从索引的第七位开始搜索，即从最后一个o处开始，搜索前7个字符的字符串。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// false. 从字符串&quot;world&quot;中的&quot;r&quot;开始匹配，它位于索引第八位。</span>
</code></pre></div><blockquote><p>如果你没有按照要求传入一个字符串，而是传入一个正则表达式，会触发一个错误。而对于<code>indexOf()</code>和<code>lastIndexOf()</code>，都会把正则表达式转化为一个字符串并搜索它。</p></blockquote> <h2 id="repeat"><a href="#repeat" aria-hidden="true" class="header-anchor">#</a> <code>repeat()</code></h2> <p>ES6 增添的<code>repeat()</code>方法，其接受一个<code>Number</code>类型的参数，表示该字符串的重复次数，返回将当前字符串重复一定次数后的新字符串。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'xxx'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'hellohello'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'abcabcabcabc'</span>
</code></pre></div><h2 id="正则表达式y修饰符"><a href="#正则表达式y修饰符" aria-hidden="true" class="header-anchor">#</a> 正则表达式y修饰符</h2> <p>使用y运算符的正则表达式，只会在<code>lastIndex</code>属性值的位置开始搜索，如果在这个指定位置没有匹配到相应字符，就停止搜索，返回<code>null</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">'hello1 hello2 hello3'</span><span class="token punctuation">,</span>
    pattern <span class="token operator">=</span> <span class="token regex">/hello\d\s?/</span><span class="token punctuation">,</span>
    result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
    globalPattern <span class="token operator">=</span> <span class="token regex">/hello\d\s?/g</span><span class="token punctuation">,</span>
    globalResult <span class="token operator">=</span> globalPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
    stickyPattern <span class="token operator">=</span> <span class="token regex">/hello\d\s?/y</span><span class="token punctuation">,</span>
    stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 'hello1'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 'hello1'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 'hello1'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 7</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 7</span>

result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalResult <span class="token operator">=</span> globalPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 'hello1'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 'hello2'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 'hello2'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 14</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyPattern<span class="token punctuation">.</span>lastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 14</span>

<span class="token comment">// 从1开始搜索</span>
pattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
globalPattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
stickyPattern<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

result <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalResult <span class="token operator">=</span> globalPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
stickyResult <span class="token operator">=</span> stickyPattern<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 'hello1'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 'hello2'</span>

<span class="token comment">// 由于从第二个字符开始匹配不到相应字符串，</span>
<span class="token comment">// 所以终止搜索，返回`null`。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stickyResult<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//  null</span>
</code></pre></div><p>关于y运算符，还有两点要注意：</p> <ul><li>只有调用<code>exec()</code>和<code>test()</code>这些正则表达式对象的方法才会涉及<code>lastIndex</code>属性；调用字符串的方法，例如<code>match()</code>，则不会触发粘滞行为。</li> <li>对于粘滞正则表达式而言，如果使用<code>^</code>字符匹配字符串开端，只会从字符串的起始位置或多行模式首行进行匹配。当<code>lastIndex</code>值为0时，如果正则表达式含有<code>^</code>，则是否使用粘滞正则表达式并无区别；如果<code>lastIndex</code>值在单行模式下不为0，或在多行模式下不对应行首，则粘滞表达式永远不会成功匹配。</li></ul> <p>可以通过<code>sticky</code>属性检测y修饰符是否存在：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> pattern <span class="token operator">=</span> <span class="token regex">/hello\d/y</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span>sticky<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>可以通过以下方式检测当前引擎是否支持y修饰符：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hasRegExpY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="复制正则表达式"><a href="#复制正则表达式" aria-hidden="true" class="header-anchor">#</a> 复制正则表达式</h2> <p>在ES6中，可以通过RegExp构造函数第二个参数修改其修饰符。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> re1 <span class="token operator">=</span> <span class="token regex">/ab/i</span><span class="token punctuation">,</span>

<span class="token comment">// 在ES5中报错，在ES6中正常运行。</span>
re2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>re1<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '/ab/i'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '/ab/g'</span>
</code></pre></div><h2 id="flags属性"><a href="#flags属性" aria-hidden="true" class="header-anchor">#</a> flags属性</h2> <p>在ES6中，访问flags属性会返回所有应用于当前正则表达式的修饰字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> re <span class="token operator">=</span> <span class="token regex">/ab/g</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'ab'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>flags<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'g'</span>
</code></pre></div><h2 id="模板字面量"><a href="#模板字面量" aria-hidden="true" class="header-anchor">#</a> 模板字面量</h2> <p>ECMAScript 6 新增的模板字面量语法支持创建领域专用语言（Domain Special Language，DSL）。DSL通常指专门针对某些具体且有限的问题而设计的语言。根据是否从宿主语言（指通过一种语言构建另一种语言，如Java是构建在C上的语言）构建而来，DSL分为：</p> <ul><li>内部DSL（从一种宿主语言构建而来）</li> <li>外部DSL（从零开始构建的语言，需要实现语法分析器等）</li></ul> <h3 id="多行字符串"><a href="#多行字符串" aria-hidden="true" class="header-anchor">#</a> 多行字符串</h3> <p>ES6以前，创造多行字符串，需要手动加入换行符，并使用<code>\</code>承接上一行代码。</p> <p>现在，可以使用正规的模板字面量语法，空白符、换行符都属于字符串的一部分：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES5</span>
<span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'Multiline \n\
string'</span><span class="token punctuation">;</span>

<span class="token comment">// ES6</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token string">`Multiline 
string`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 也可以显式声明</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token template-string"><span class="token string">`Multiline\nstring`</span></span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16</span>
</code></pre></div><h3 id="字符串占位符"><a href="#字符串占位符" aria-hidden="true" class="header-anchor">#</a> 字符串占位符</h3> <p>占位符由左侧<code>${</code>和右侧的<code>}</code>符号组成，中间可以包含任意的JavaScript表达式，通过占位符可以直接将该作用域的局部变量嵌入输出的字符串中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
    price <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">,</span>
    message <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items cost $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>count <span class="token operator">*</span> price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '10 items cost $2.50.'</span>
</code></pre></div><h3 id="标签模板"><a href="#标签模板" aria-hidden="true" class="header-anchor">#</a> 标签模板</h3> <p>标签指在模板字面量第一个反撇号前的字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> message <span class="token operator">=</span> tag<span class="token template-string"><span class="token string">`Hello world`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 此时，模板标签是 tag</span>
</code></pre></div><p>标签可以是一个函数，传入的字符串会被分成各部分，每部分作为一个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
    price <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">,</span>
    message <span class="token operator">=</span> passthru<span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> items cost $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>count <span class="token operator">*</span> price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.`</span></span><span class="token punctuation">;</span>
    
    <span class="token comment">// 等同于</span>
    message <span class="token operator">=</span> <span class="token function">passthru</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">' items cost $'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2.50</span><span class="token punctuation">)</span>
</code></pre></div> <h3 id="访问转义前字符串"><a href="#访问转义前字符串" aria-hidden="true" class="header-anchor">#</a> 访问转义前字符串</h3> <p>用<code>String.raw()</code>标签函数，可以访问字符转义转换前的原生字符串：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> message1 <span class="token operator">=</span> <span class="token template-string"><span class="token string">`Multiline\nstring`</span></span><span class="token punctuation">,</span>
    message2 <span class="token operator">=</span> String<span class="token punctuation">.</span>raw<span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
    
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Multiline</span>
                      <span class="token comment">//  string'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Multiline\\nstring'</span>
</code></pre></div><p>模板标签函数的第一个参数是数组，它有一个<code>raw</code>属性，也可以用其访问原生字符串信息。</p> <hr> <p><strong>参考资料</strong></p> <ul><li>《深入理解ES6》</li> <li><a href="http://es6.ruanyifeng.com/#docs/string#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2" target="_blank" rel="noopener noreferrer">《ECMAScript 6 入门》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://blog.csdn.net/u010278882/article/details/50554299" target="_blank" rel="noopener noreferrer">DSL简介<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/17266c5b8d1c" target="_blank" rel="noopener noreferrer">DSL编程技术的介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/7.3a68b4cb.js" defer></script><script src="/assets/js/app.73a72f5f.js" defer></script>
  </body>
</html>
